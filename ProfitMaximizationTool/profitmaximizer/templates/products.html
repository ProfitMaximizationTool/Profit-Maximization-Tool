{% extends "base.html" %}

{% block title %}<title>Profitify: Products</title>{% endblock %}

{% block add-record %}
<div class="add-record overlay" id="add-product-overlay">
    <button class="close" id="close-import"><b>&#10005</b></button>
    <div class="import-inner">
        <form autocomplete="off" action="/add-product/" method="POST">
            {% csrf_token %}
            <div class="record-title">
                Add new product record
            </div>
            <div class="record-field">
                Product Name
                <div class="string-input-size input-box">
                    <input type="text" class="string-input move" name="new-product-name">
                </div>
            </div>
            <div class="record-field">
                Ingredients (Json format)
                <div class="string-input-size input-box">
                    <input type="text" class="string-input move" name="new-product-ingredients">
                </div>
            </div>
            <div class="record-field">
                Price
                <div class="int-input-size input-box">
                    <input type="number" class="int-input move" name="new-product-price">
                </div>
            </div>
            <input type="submit" value="Save" class="fill small-btn btn" name="add-product-btn">
        </form>
    </div>
</div>
{% endblock %}

{% block edit-record %}
<div class="edit-record overlay" id="edit-product-overlay">
    <button class="close" id="close-import"><b>&#10005</b></button>
    <div class="import-inner">
        <form autocomplete="off" action="/edit-product/" method="POST">
            {% csrf_token %}
            <input type="text" class="hidden" name="edit-product-record-id" id="edit-product-record-id">
            <div class="record-title" id="edit-product-text">
            </div>
            <div class="record-field">
                Product Name
                <div class="string-input-size input-box">
                    <input type="text" class="string-input move" name="edit-product-name" id="edit-product-name">
                </div>
            </div>
            <div class="record-field">
                Product Ingredients
                <div class="string-input-size input-box">
                    <input type="text" step="any" class="user-info" name="edit-product-ingredients" id="edit-product-ingredients">
                </div>
            </div>
            <div class="record-field">
                Product Price
                <div class="int-input-size input-box">
                    <input type="number" step="any" class="user-info" name="edit-product-price" id="edit-product-price">
                </div>
            </div>
            <input type="submit" value="SUBMIT" class=" fill dynamic-btn btn" name="edit-product-btn">
        </form>
    </div>
</div>
{% endblock %}

{% block delete-record %}
<div class="delete-record overlay" id="delete-product-overlay">
    <div class="import-inner">
        <button class="close" id="close-import"><b>&#10005</b></button>
        <div class="centered-text dark-font xlarge-font bold text" id="delete-product-text">
        </div>
        <form autocomplete="off" action="/delete-product/" method="POST">
            {% csrf_token %}
            <input type="text" class="hidden" name="delete-product-record-id" id="delete-product-record-id">
            <input type="submit" value="Yes" class="fill dynamic-btn btn half-width" name="delete-product-btn">
            <input type="submit" value="Cancel" class="outline dynamic-btn btn half-width close">
        </form>
    </div>
</div>
{% endblock %}

{% block page-content %}
<div class="page-title">
    Products
    <input type="button" class="fill small-btn right btn" value="+ Add new record" id="product-overlay-btn">
</div>
<div class="success prompt full-width center text" id="successful-product-add-prompt">
    Product added!
</div>
<div class="success prompt full-width text" id="successful-product-edit-prompt">
    Product edited!
</div>
<div class="success prompt full-width text" id="successful-product-delete-prompt">
    Product deleted!
</div>
<div class="error prompt full-width text" id="invalid-product-ingredients-input">
    Invalid ingredients input. Input should be in JSON format.
</div>
<br>
<div class="table-container">
    <table class="data-table">
        <tr>
            <th class="record-id"> ID </th> 
            <th class="record-name"> Product Name </th> 
            <th class="record-items"> Ingredients/Materials </th> 
            <th class="record-price"> Cost </th>
            <th class="record-price"> Price </th>
            <th class="record-btns">  </th>
        </tr>
        {% for product in products_data %}
        <tr class="product-record data-table-row" id="product-record-{{ product.id }}">
            <td class="record-id"> {{ product.id }} </td>
            <td class="record-name"> {{ product.productName }} </td>
            
            <td>
            {% for ingr, quantity in product.ingredients.items %}
                {{ ingr }} ({{ quantity }} units) <br>
            {% endfor %}
            </td>
            
            <td> {{ product.cost }} </td>
            <td> {{ product.price }} </td>

            <input type="text" class="hidden" value="{{ product.ingredients }}" id="product-{{ product.id }}-ingredients">
            
            <td class="record-btns">
                <ion-icon class="record-icon btn edit-product" name="pencil"></ion-icon>
                <ion-icon class="record-icon btn delete-product" name="trash"></ion-icon>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

{% endblock %}